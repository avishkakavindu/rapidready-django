{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block content %}

    <div style="background: url('{% static 'images/main_back.jpg' %}'); background-size: auto;">
        <div class="container p-5" style="background-color: #fff;">
            <!-- service -->
            <div id="service" class="row">
                <!-- for images -->
                <div class="col-md col-lg-5">
                    <div class="row">
                        <div class="main-img">
                            <img src="{{ service.image.url }}" class="img-thumbnail img-fluid">
                        </div>
                    </div>
                </div>
                <!-- for description -->
                <div class="col-md col-lg service-details">
                    <h1>{{ service.service }}</h1>
                    <!-- Star rating -->
                    <span class="star-rating" data-rating="{{ service.average_rating }}">
                        <!-- js based starrating -->
                    </span>
                    <small> {{ service.rating_count }} reviews</small>
                    <hr>
                    <p class="p-desc">
                        {{ service.desc }}
                    </p>
                    <div class="pricing">
                        <p>
                            <span>Price:</span>
                            {% if service.discount == 0 %}
                                <span class="price-actual">{{ service.actual_price }}</span>
                            {% else %}
                                <span class="price-actual">
                                    {{ service.actual_price }}
                                    <del>
                                        <small>$ {{ service.price }}</small>
                                    </del>
                                </span>
                            {% endif %}
                        </p>
                        <form>
                            {% csrf_token %}
                            <p>
                                <span>Quantity: </span>
                                <input id="service-quantity" class="quantity" min="0" name="quantity" value="100"
                                       type="number">
                            </p>
                            <button id="add-to-cart" type="button" class="btn btn-outline-primary update-cart"
                                    data-action="add-serving"
                                    data-service="{{ service.id }}">
                                <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                                <span> Add to cart</span>
                            </button>
                        </form>
                    </div>

                    <!-- Review summary -->
                    <div class="col-md col-lg mt-5 border p-3">
                        <div class="row  graphical-avg">
                            <div class="col-md col-lg-5 self-align-right">
                                <h5> Average user rating</h5>
                                <h4>{{ service.average_rating }}<span>/5</span></h4>

                                <!-- Star rating -->
                                <span class="star-rating" data-rating="{{ service.average_rating }}">
                                    <p>{{ service.average_rating }}</p>
                                </span>
                            </div>
                            <!-- Rating Breakdown -->
                            <div class="col-md col-lg rating-breakdown">
                                <h5>Rating breakdown</h5>
                                <div class="progressbars">
                                    <!-- 5 stars -->
                                    <div class="flex-grow-1">
                                        <div class="row align-items-center">
                                            <div class="col-md col-lg-4  text-lg-right" style="font-size: 10px;">
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                            </div>

                                            <div class="col-sm col-lg-8">
                                                <div class="progress">
                                                    <div class="progress-bar" role="progressbar"
                                                         style="width: 20%" aria-valuenow="25" aria-valuemin="0"
                                                         aria-valuemax="100">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 4 stars -->
                                    <div class="flex-grow-1">
                                        <div class="row align-items-center">
                                            <div class="col-md col-lg-4  text-lg-right" style="font-size: 10px;">
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                            </div>
                                            <div class="col-sm col-lg-8">
                                                <div class="progress">
                                                    <div class="progress-bar" role="progressbar"
                                                         style="width: 50%" aria-valuenow="75" aria-valuemin="0"
                                                         aria-valuemax="100">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 3 stars -->
                                    <div class="flex-grow-1">
                                        <div class="row align-items-center">
                                            <div class="col-md col-lg-4  text-lg-right" style="font-size: 10px;">
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                            </div>
                                            <div class="col-sm col-lg-8">
                                                <div class="progress">
                                                    <div class="progress-bar" role="progressbar"
                                                         style="width: 70%" aria-valuenow="55" aria-valuemin="0"
                                                         aria-valuemax="100">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 2 stars -->
                                    <div class="flex-grow-1">
                                        <div class="row align-items-center">
                                            <div class="col-md col-lg-4  text-lg-right" style="font-size: 10px;">
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                            </div>
                                            <div class="col-sm col-lg-8">
                                                <div class="progress">
                                                    <div class="progress-bar" role="progressbar"
                                                         style="width: 60%" aria-valuenow="75" aria-valuemin="0"
                                                         aria-valuemax="100">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 1 stars -->
                                    <div class="flex-grow-1">
                                        <div class="row align-items-center">
                                            <div class="col-md col-lg-4  text-lg-right" style="font-size: 10px;">
                                                <i class="fa fa-star" aria-hidden="true"></i>
                                            </div>
                                            <div class="col-sm col-lg-8">
                                                <div class="progress">
                                                    <div class="progress-bar" role="progressbar"
                                                         style="width: 10%" aria-valuenow="75" aria-valuemin="0"
                                                         aria-valuemax="100">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- END-Review summary -->

                    <!-- Reviews -->
                    <div class="row mt-5" id="reviews">
                        <div class="col-md col-lg">
                            <!-- Review tabs -->
                            <nav>
                                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                                    <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab"
                                       href="#nav-home" role="tab" aria-controls="nav-home"
                                       aria-selected="true">Reviews</a>
                                    <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab"
                                       href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">Your
                                        review</a>
                                </div>
                            </nav>
                            <div class="tab-content" id="nav-tabContent">
                                <div class="container tab-pane active fade show overflow-auto mt-2" id="nav-home"
                                     role="tabpanel"
                                     aria-labelledby="nav-home-tab" style="height:400px;">
                                    <!-- Review -->
                                    {% if reviews %}
                                        {% for review in reviews %}
                                            <div class="row mt-3 mb-3 border-bottom pb-3 reviews">
                                                <div class="col-md col-lg-3 text-center">
                                                    <img src="{{ review.user.profile_pic.url }}"
                                                         class="img-thumbnail rounded-circle review-pic">
                                                    <p class="review-username">
                                                        {{ review.user }}
                                                    </p>
                                                </div>

                                                <div class="col-md col-lg">
                                                    <p class="review-desc">
                                                        {{ review.review|default:"None" }}
                                                    </p>
                                                    <!-- Star rating -->
                                                    <span class="star-rating rev-rating"
                                                          data-rating="{{ review.rating }}">
                                                        <p>{{ review.rating }}</p>

                                                    </span>
                                                    <span class="review-date">{{ review.created_on }} </span>
                                                </div>
                                            </div>
                                            <!-- End of review -->
                                        {% endfor %}
                                    {% else %}
                                        <div class="alert alert-primary mt-2" role="alert">
                                            No reviews found! Be the first to review this service.<i
                                                class="fa fa-smile-o" aria-hidden="true"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="tab-pane border-bottom mt-2" id="nav-profile" role="tabpanel"
                                     aria-labelledby="nav-profile-tab">

                                    {% if user.is_authenticated %}
                                        <form class="needs-validation" action="" method="post" novalidate>
                                            {% csrf_token %}
                                            <div class="form-group mb-3">
                                                <label for="review">Review</label>
                                                {% render_field form.review class="form-control" %}
                                            </div>

                                            {% render_field form.rating class="form-control" %}
                                            <div class="rating-system">
                                            <span class="fa fa-star-o rate-me" data-toggle="tooltip"
                                                  data-placement="top" title="Very bad"></span>
                                                <span class="fa fa-star-o rate-me" data-toggle="tooltip"
                                                      data-placement="top" title="Poor"></span>
                                                <span class="fa fa-star-o rate-me" data-toggle="tooltip"
                                                      data-placement="top" title="Ok"></span>
                                                <span class="fa fa-star-o rate-me" data-toggle="tooltip"
                                                      data-placement="top" title="Good"></span>
                                                <span class="fa fa-star-o rate-me" data-toggle="tooltip"
                                                      data-placement="top" title="Excellent"></span>
                                            </div>

                                            <button class="btn btn-success float-right mt-2 mb-2" type="submit">
                                                Submit
                                            </button>
                                        </form>
                                    {% else %}
                                        <a href="{% url 'login' %}">Please Signin to review</a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}
